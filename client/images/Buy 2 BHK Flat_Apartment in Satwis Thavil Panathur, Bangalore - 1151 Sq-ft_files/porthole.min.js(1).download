(function(){var d=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.PortholeClass=function(){};PortholeClass.extend=function(a){var b=this.prototype;d=true;var h=new this();d=false;for(var i in a){h[i]=typeof a[i]=="function"&&typeof b[i]=="function"&&c.test(a[i])?(function(f,e){return function(){var g=this._super;this._super=b[f];var l=e.apply(this,arguments);this._super=g;return l}})(i,a[i]):a[i]}function j(){if(!d&&this.init){this.init.apply(this,arguments)}}j.prototype=h;j.prototype.constructor=j;j.extend=arguments.callee;return j}})();(function(f){var d={debug:false,trace:function(a){if(this.debug&&f.console!==undefined){f.console.log("Porthole: "+a)}},error:function(a){if(f.console!==undefined){f.console.error("Porthole: "+a)}}};d.WindowProxy=function(){};d.WindowProxy.prototype={post:function(a,b){},addEventListener:function(a){},removeEventListener:function(a){}};d.WindowProxyBase=PortholeClass.extend({init:function(a){if(a===undefined){a=""}this.targetWindowName=a;this.origin=f.location.protocol+"//"+f.location.host;this.eventListeners=[]},getTargetWindowName:function(){return this.targetWindowName},getOrigin:function(){return this.origin},getTargetWindow:function(){return d.WindowProxy.getTargetWindow(this.targetWindowName)},post:function(a,b){if(b===undefined){b="*"}this.dispatchMessage({data:a,sourceOrigin:this.getOrigin(),targetOrigin:b,sourceWindowName:f.name,targetWindowName:this.getTargetWindowName()})},addEventListener:function(a){this.eventListeners.push(a);return a},removeEventListener:function(b){var c;try{c=this.eventListeners.indexOf(b);this.eventListeners.splice(c,1)}catch(a){this.eventListeners=[]}},dispatchEvent:function(b){var c;for(c=0;c<this.eventListeners.length;c++){try{this.eventListeners[c](b)}catch(a){}}}});d.WindowProxyLegacy=d.WindowProxyBase.extend({init:function(b,a){this._super(a);if(b!==null){this.proxyIFrameName=this.targetWindowName+"ProxyIFrame";this.proxyIFrameLocation=b;this.proxyIFrameElement=this.createIFrameProxy()}else{this.proxyIFrameElement=null;d.trace("proxyIFrameUrl is null, window will be a receiver only");this.post=function(){throw new Error("Receiver only window")}}},createIFrameProxy:function(){var a=document.createElement("iframe");a.setAttribute("id",this.proxyIFrameName);a.setAttribute("name",this.proxyIFrameName);a.setAttribute("src",this.proxyIFrameLocation);a.setAttribute("frameBorder","1");a.setAttribute("scrolling","auto");a.setAttribute("width",30);a.setAttribute("height",30);a.setAttribute("style","position: absolute; left: -100px; top:0px;");if(a.style.setAttribute){a.style.setAttribute("cssText","position: absolute; left: -100px; top:0px;")}document.body.appendChild(a);return a},dispatchMessage:function(b){var c=f.encodeURIComponent;if(this.proxyIFrameElement){var a=this.proxyIFrameLocation+"#"+c(d.WindowProxy.serialize(b));this.proxyIFrameElement.setAttribute("src",a);this.proxyIFrameElement.height=this.proxyIFrameElement.height>50?50:100}}});d.WindowProxyHTML5=d.WindowProxyBase.extend({init:function(b,a){this._super(a);this.eventListenerCallback=null},dispatchMessage:function(a){this.getTargetWindow().postMessage(d.WindowProxy.serialize(a),a.targetOrigin)},addEventListener:function(a){if(this.eventListeners.length===0){var b=this;if(f.addEventListener){this.eventListenerCallback=function(c){b.eventListener(b,c)};f.addEventListener("message",this.eventListenerCallback,false)}else{if(f.attachEvent){this.eventListenerCallback=function(c){b.eventListener(b,f.event)};f.attachEvent("onmessage",this.eventListenerCallback)}}}return this._super(a)},removeEventListener:function(a){this._super(a);if(this.eventListeners.length===0){if(f.removeEventListener){f.removeEventListener("message",this.eventListenerCallback)}else{if(f.detachEvent){if(typeof f.onmessage==="undefined"){f.onmessage=null}f.detachEvent("onmessage",this.eventListenerCallback)}}this.eventListenerCallback=null}},eventListener:function(b,c){var a=d.WindowProxy.unserialize(c.data);if(a&&(b.targetWindowName===""||a.sourceWindowName==b.targetWindowName)){b.dispatchEvent(new d.MessageEvent(a.data,c.origin,b))}}});if(!f.postMessage){d.trace("Using legacy browser support");d.WindowProxy=d.WindowProxyLegacy.extend({})}else{d.trace("Using built-in browser support");d.WindowProxy=d.WindowProxyHTML5.extend({})}d.WindowProxy.serialize=function(a){if(typeof JSON==="undefined"){throw new Error("Porthole serialization depends on JSON!")}return JSON.stringify(a)};d.WindowProxy.unserialize=function(a){if(typeof JSON==="undefined"){throw new Error("Porthole unserialization dependens on JSON!")}try{var c=JSON.parse(a)}catch(b){return false}return c};d.WindowProxy.getTargetWindow=function(a){if(a===""){return parent}else{if(a==="top"||a==="parent"){return f[a]}}return f.frames[a]};d.MessageEvent=function e(a,c,b){this.data=a;this.origin=c;this.source=b};d.WindowProxyDispatcher={forwardMessageEvent:function(a){var c,b=f.decodeURIComponent,j,k;if(document.location.hash.length>0){c=d.WindowProxy.unserialize(b(document.location.hash.substr(1)));j=d.WindowProxy.getTargetWindow(c.targetWindowName);k=d.WindowProxyDispatcher.findWindowProxyObjectInWindow(j,c.sourceWindowName);if(k){if(k.origin===c.targetOrigin||c.targetOrigin==="*"){k.dispatchEvent(new d.MessageEvent(c.data,c.sourceOrigin,k))}else{d.error("Target origin "+k.origin+" does not match desired target of "+c.targetOrigin)}}else{d.error("Could not find window proxy object on the target window")}}},findWindowProxyObjectInWindow:function(i,b){var c;if(i){for(c in i){if(Object.prototype.hasOwnProperty.call(i,c)){try{if(i[c]!==null&&typeof i[c]==="object"&&i[c] instanceof i.Porthole.WindowProxy&&i[c].getTargetWindowName()===b){return i[c]}}catch(a){}}}}return null},start:function(){if(f.addEventListener){f.addEventListener("resize",d.WindowProxyDispatcher.forwardMessageEvent,false)}else{if(f.attachEvent&&f.postMessage!=="undefined"){f.attachEvent("onresize",d.WindowProxyDispatcher.forwardMessageEvent)}else{if(document.body.attachEvent){f.attachEvent("onresize",d.WindowProxyDispatcher.forwardMessageEvent)}else{d.error("Cannot attach resize event")}}}}};if(typeof f.exports!=="undefined"){f.exports.Porthole=d}else{f.Porthole=d}})(this);